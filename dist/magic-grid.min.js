!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.MagicGrid=e()}(this,function(){"use strict";var t=function(t){if(!t)throw new Error("No config object has been provided.");"boolean"!=typeof t.useTransform&&(t.useTransform=!0),"number"!=typeof t.gutter&&(t.gutter=25),t.container||e("container"),t.items||t.static||e("items or static")},e=function(t){throw new Error("Missing property '"+t+"' in MagicGrid config")},i=function(t){var e=t[0];for(var i of t)i.height<e.height&&(e=i);return e},s=function(e){t(e),e.container instanceof HTMLElement?(this.container=e.container,this.containerClass=e.container.className):(this.containerClass=e.container,this.container=document.querySelector(e.container)),this.items=this.container.children,this.static=e.static||!1,this.size=e.items,this.gutter=e.gutter,this.maxColumns=e.maxColumns||!1,this.useMin=e.useMin||!1,this.useTransform=e.useTransform,this.animate=e.animate||!1,this.started=!1,this.listen=this.listen.bind(this),this.positionItems=this.positionItems.bind(this),this.destroy=this.destroy.bind(this),this.handleWindowResize=this.handleWindowResize.bind(this),this.init()};return s.prototype.init=function(){if(this.ready()&&!this.started){this.container.style.position="relative";for(var t=0;t<this.items.length;t++){var e=this.items[t].style;e.position="absolute",this.animate&&(e.transition=(this.useTransform?"transform":"top, left")+" 0.2s ease")}this.started=!0,this.listen()}},s.prototype.colWidth=function(){return this.items[0].getBoundingClientRect().width+this.gutter},s.prototype.setup=function(){var t=this.container.getBoundingClientRect().width,e=this.colWidth(),i=Math.floor(t/e)||1,s=[];this.maxColumns&&i>this.maxColumns&&(i=this.maxColumns);for(var n=0;n<i;n++)s[n]={height:0,index:n};return{cols:s,wSpace:t-i*e+this.gutter}},s.prototype.nextCol=function(t,e){return this.useMin?i(t):t[e%t.length]},s.prototype.positionItems=function(){var t=this.setup(),e=t.cols,i=t.wSpace,s=0,n=this.colWidth();i=Math.floor(i/2);for(var o=0;o<this.items.length;o++){var r=this.nextCol(e,o),h=this.items[o],a=r.height?this.gutter:0,c=r.index*n+i+"px",l=r.height+a+"px";this.useTransform?h.style.transform="translate("+c+", "+l+")":(h.style.top=l,h.style.left=c),r.height+=h.getBoundingClientRect().height+a,r.height>s&&(s=r.height)}this.container.style.height=s+"px"},s.prototype.ready=function(){return!!this.static||this.items.length>=this.size},s.prototype.getReady=function(){var t=this,e=setInterval(function(){t.container=document.querySelector(t.containerClass),t.items=t.container.children,t.ready()&&(clearInterval(e),t.init(),t.listen())},100)},s.prototype.listen=function(){this.ready()?(window.addEventListener("resize",this.handleWindowResize),this.positionItems()):this.getReady()},s.prototype.handleWindowResize=function(){var t=this;this._timeout||(console.log(),this._timeout=setTimeout(function(){t.positionItems(),t._timeout=null},200))},s.prototype.destroy=function(){var t=this;this.started=!1,this.container.style.removeProperty("height"),this.container.style.removeProperty("position"),[].slice.call(this.items).map(function(e){e.style.removeProperty("position"),e.style.removeProperty("transition"),t.useTransform?e.style.removeProperty("transform"):(e.style.removeProperty("top"),e.style.removeProperty("left"))}),window.removeEventListener("resize",this.handleWindowResize)},s});
